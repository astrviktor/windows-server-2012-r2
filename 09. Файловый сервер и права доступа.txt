Файловый сервер

Существуют много структур построения файлового сервера
Нужно думать, что подойдет в конкретной организации в зависимости от структуры, собрав информацию

Для теста нам подойдет деление по подразделениям, без географической привязки к сайтам, 
и без выделения начальников отделов с особыми правами

Делаем новый разностный виртуальный диск и новую виртуальную машину fs

01. Создаем диск для HIPER-V
	Создать -> Жесткий диск
	Формат VHDX
	Раздностный
	Имя: fs.vhdx
	Родительский диск: ws2012r2-base.vhdx

01. Создаем диск для HIPER-V
	Создать -> Жесткий диск
	Формат VHDX
	Динамический
	Имя: storage.vhdx
	Размер: 10Gb

03. Создаем VM
	Имя: fs
	Поколение 1
	Память при запуске: 1024
	Подключение: MainSwitch
	Жесткий диск: Подключить имеющийся fs.vhdx

Установим систему и введем в домен
IP 192.168.11.11/24, router 192.168.22.1, DNS 192.168.11.2, 192.168.11.3, 192.168.22.2

После установки подключаем диск storage.vhdx на котором будет хранилище
Система на отдельном диске, хранилище на отдельном
Tools / Computer Managment / Disks

Включаем Shadow Copies (для возможности восстановления файлов)
	Правой кнопкой на диск / Configure Shadow Copies / Enable и затем Settings
	Задаем лимит диска и можем задать расписание
	Можно создавать Shadow Copy в любое время кнопкой Create Now

Создаем структуру наших папок
	Share
		Directors
		Accounting
		Sales
		IT		

Примечание: будем работать с группой Domain Users, подразумевая что всем пользователям AD должен быть 
доступен доступ к FS. Если это не так, нужно будет создать другую группу и работать с ней

01. Создаем Share 
	- Properties / Security / Advanced выключить наследование Disable inheritance и удалить все разрешения
	- Добавляем локальную группу Administrators, Full control
	- Добавляем доменную группу Domain Users, область действия This folder only (смогут увидеть только внутри папки), ставим разрешение только Traverse Folder и List Folder (Show Advance Permission)
	- Добавляем специального пользвателя CREATOR OWNER добавляем Modify

02. Добавляем внутри Share папки 
	Directors
	Accounting
	Sales
	IT
	Change - для всех

03. Добавляем соответствующие права для Resource Groups на папки

04. Добавляем на папку Change для всех Domain Users права Modify

05. Нужно расшарить папку Share
	S:\Share / properties / Sharing / Advanced Sharing / Permission / Everyone full control

06. Проверяем:
	На машине client заходим под пользователем randell.hermanson@ecorp.local / qwerty`123
	Заходим в проводник и открываем \\fs.ecorp.local\Share
	randell.hermanson относится к группе Directors, пробуем создать / удалить файл в этой группе.
	Пробуем создать / удалить файл в других группах.

Иногда хочется скрыть папки из видимости для пользователей, у которых к которым нет доступа. 2012 такое позволяет.
	Заходим на fs / Sever Manager / Files and Storage Services / Shares / на ней Properties / Settings
	Включить access-based enumiration


Дополнительно на файловом сервере нужно настраивать FSRM (File Server Resource Manager)